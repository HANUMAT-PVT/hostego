# Step 1: Build the Go binary statically
FROM golang:latest as builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

# ‚õîÔ∏è No need to copy .env here ‚Äî it's for runtime
# COPY .env .env  ‚ùå

# üîê Build statically
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o backend-hostego .

# Step 2: Use minimal base image
FROM alpine:latest

WORKDIR /root

# Copy the binary
COPY --from=builder /app/backend-hostego .



# ‚úÖ Copy .env file into runtime container
COPY .env .env

# Copy firebase service account file for dev

# COPY config/firebase-service-account.json config/firebase-service-account.json

# Expose port
EXPOSE 8000

# Start app
CMD ["./backend-hostego"]
